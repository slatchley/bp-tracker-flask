{% extends "base.html" %}
{% block content %}
<section class="card">
    <h2>Add a Reading</h2>
    <form method="POST" action="{{ url_for('add') }}" class="grid">
        <label>
            <span>Date</span>
            <input type="date" name="date" value="{{ (now or '')[:10] }}" required>
        </label>
        <label>
            <span>Systolic</span>
            <input type="number" name="systolic" min="70" max="260" required placeholder="e.g., 120">
        </label>
        <label>
            <span>Diastolic</span>
            <input type="number" name="diastolic" min="40" max="150" required placeholder="e.g., 80">
        </label>
        <label>
            <span>Pulse (optional)</span>
            <input type="number" name="pulse" min="20" max="220" placeholder="e.g., 70">
        </label>
        <button type="submit">Add</button>
    </form>
</section>

<section class="card">
    <div class="table-header">
        <h2>Readings</h2>
        <form>
            <label for="sort">Sort</label>
            <select name="sort" id="sort" onchange="this.form.submit()">
                <option value="created_at_desc" {{ 'selected' if sort=='created_at_desc' }}>Newest</option>
                <option value="created_at_asc" {{ 'selected' if sort=='created_at_asc' }}>Oldest</option>

            </select>
        </form>
    </div>
    <table>
        <thead>
            <tr>
                <th>Date/Time</th>
                <th>Systolic</th>
                <th>Diastolic</th>
                <th>Pulse</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for r in readings %}
            <tr>
                <td>{{ r.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>{{ r.systolic }}</td>
                <td>{{ r.diastolic }}</td>
                <td>{{ r.pulse if r.pulse is not none else 'â€”' }}</td>
                <td>
                    <form method="POST" action="{{ url_for('delete', reading_id=r.id) }}" onsubmit="return confirm('Delete this reading?');">
                        <button type="submit" class="danger">Delete</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="5" class="muted">No readings yet.</td></tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="pagination" style="text-align:center; margin-top:1em;">
        {% if has_prev %}
            <a href="{{ url_for('index', sort=sort, page=page-1) }}" class="arrow">&larr; Prev</a>
        {% endif %}
        <span style="margin:0 1em;">Page {{ page }}</span>
        {% if has_next %}
            <a href="{{ url_for('index', sort=sort, page=page+1) }}" class="arrow">Next &rarr;</a>
        {% endif %}
    </div>
</section>

<section class="card">
  <h2>Graph</h2>
  <img src="{{ url_for('plot_png') }}" alt="Blood pressure chart" class="graph-img">
</section>

{% endblock %}